# Changelog - 2025-08-07

## SSH Runner - Phase 3 Completion: API Mode Implementation

### Orchestrator Updates

- [2025-08-07] [Feature] Implemented JWT token generation for job executions in orchestrator
- [2025-08-07] [Feature] Added SSH reverse tunnel manager for API mode communication
- [2025-08-07] [Feature] Integrated API mode into SSH executor with automatic fallback to bundled mode
- [2025-08-07] [Feature] Pass API configuration via environment variables to runner

### Runner Updates

- [2025-08-07] [Feature] Updated helper setup to prioritize environment variables over manifest
- [2025-08-07] [Feature] Added configuration logging for debugging API mode
- [2025-08-07] [Feature] Support for both API and bundled modes based on environment

### Runtime Service Updates

- [2025-08-07] [Feature] Updated JWT claims to support tokens from orchestrator (added jobId field)
- [2025-08-07] [Feature] Confirmed all helper endpoints are ready for API mode
- [2025-08-07] [Feature] Backend integration for execution context retrieval

### Testing

- [2025-08-07] [Testing] Created comprehensive test scripts for API mode
- [2025-08-07] [Testing] Implemented mock runtime API for testing
- [2025-08-07] [Testing] Added environment variable test scripts

## Summary

Phase 3 of the SSH runner implementation is now complete. The system supports both bundled mode (for offline execution) and API mode (via SSH reverse tunnel) for runtime helpers. API mode allows remote scripts to access live data from the platform, share variables, and execute tool actions through a secure JWT-authenticated channel.

## Phase 4: Multi-Server Support Implementation

### Features

- [2025-08-07] [Feature] Implemented MultiServerExecutor for parallel SSH execution across multiple servers
- [2025-08-07] [Feature] Added RunnerCache to avoid redundant runner deployments and improve performance
- [2025-08-07] [Feature] Created enhanced job transformer to support multi-server job metadata
- [2025-08-07] [Feature] Added server-prefixed logging for multi-server execution clarity
- [2025-08-07] [Feature] Implemented result aggregation with partial failure handling

### Refactor

- [2025-08-07] [Refactor] Modified SSH executor to use runner cache for deployment optimization
- [2025-08-07] [Refactor] Updated orchestrator to register multi-server executor instead of single-server
- [2025-08-07] [Refactor] Enhanced job transformation pipeline to fetch and include all associated servers

### Bug Fixes

- [2025-08-07] [Bug Fix] Fixed StatusUpdate struct usage to use OutputData instead of non-existent Metadata field
- [2025-08-07] [Bug Fix] Removed unused fmt import from runner_cache.go
- [2025-08-07] [Bug Fix] Fixed TypeScript strict mode issues with optional passphrase property

### Documentation

- [2025-08-07] [Documentation] Created phase-4-multi-server-support.md summary document
- [2025-08-07] [Documentation] Updated PLAN.md to mark Phase 4 tasks as completed

## Phase 5: Final Integration Implementation

### Error Handling

- [2025-08-07] [Feature] Implemented runner deployment retry logic with exponential backoff
- [2025-08-07] [Feature] Added proper cleanup for partial deployments
- [2025-08-07] [Feature] Implemented execution timeout handling with context deadlines
- [2025-08-07] [Feature] Added differentiation between timeout and cancellation
- [2025-08-07] [Feature] Enhanced cleanup to remove remote payload files after execution

### Monitoring & Metrics

- [2025-08-07] [Feature] Added runner version logging at execution start
- [2025-08-07] [Feature] Implemented comprehensive metrics tracking system
- [2025-08-07] [Feature] Added execution success/failure rate tracking
- [2025-08-07] [Feature] Implemented deployment cache hit rate monitoring
- [2025-08-07] [Feature] Added periodic metrics logging for observability

### Testing

- [2025-08-07] [Testing] Created executor_test.go with comprehensive unit tests
- [2025-08-07] [Testing] Added integration tests for timeout and error scenarios
- [2025-08-07] [Testing] Created helpers_test.sh for runtime helper validation
- [2025-08-07] [Testing] Implemented multi-server execution test structure

### Bug Fixes

- [2025-08-07] [Bug Fix] Fixed variable scope issues in executeWithRunner
- [2025-08-07] [Bug Fix] Corrected context usage in timeout detection

### Documentation

- [2025-08-07] [Documentation] Created phase-5-final-integration.md summary document
- [2025-08-07] [Documentation] Updated PLAN.md to mark Phase 5 tasks as completed

## UI Bug Fixes

### Event Management

- [2025-08-07] [Bug Fix] Fixed hydration error on events page by ensuring date formatting is consistent between server and client rendering
- [2025-08-07] [Bug Fix] Fixed dialog visibility issue on event details page by increasing z-index values from z-50 to z-[100]/z-[101] to prevent overlap with other UI elements
