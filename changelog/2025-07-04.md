# Changelog - 2025-07-04

- [2025-07-04] **Fix** Runtime Helper Path for Script Execution - Fixed Node.js script execution failing with "Cannot find module './cronium.js'" error. The local executor was looking for runtime helpers in the wrong directory (runtime-helpers/ instead of src/runtime-helpers/). Updated local-executor.ts:76 to use correct path: path.join(process.cwd(), "src", "runtime-helpers"). Node.js, Python, and Bash scripts now execute correctly with access to cronium helper functions.

- [2025-07-04] **Fix** Database Migration for Conditional Actions Table - Applied missing database migration to rename `conditional_events` table to `conditional_actions`. The code was updated to use the new table name but the database migration hadn't been applied, causing "Failed query" errors when fetching event details. Created and executed migration script to ALTER TABLE conditional_events RENAME TO conditional_actions. Event details page now loads correctly with all conditional actions data.

- [2025-07-04] **Fix** tRPC validation error for workflows.getAll limit parameter - Fixed validation error where limit parameter (1000) exceeded maximum allowed value of 100. Updated WorkflowList.tsx:102 and logs/page.tsx:88 to use limit: 100 instead of limit: 1000.

- [2025-07-04] **Fix** Event Details Page Loading Error - Fixed event details page failing to load with "Failed to fetch event" error. Added comprehensive error handling to storage.ts methods that perform decryption operations. Modified getEventWithRelations, getServer, and getEnvVars methods to catch and log decryption errors but continue processing rather than failing completely. This prevents encryption/decryption issues from blocking the entire event details page. Added detailed error logging to events.getById tRPC endpoint for better debugging.

- [2025-07-04] **Fix** TypeScript Errors in Monitoring Page - Fixed all TypeScript errors in src/app/[lang]/dashboard/monitoring/page.tsx according to the type safety guidelines. Key changes: Added RouterOutputs type from tRPC for proper type inference, removed all `any` usage from the monitoring data query, properly typed the SystemMonitoringData using tRPC's inferred types, fixed optional property handling by adding `| undefined` to optional interface properties (servers, activity, system), created a type-safe helper function to extract event stats, and fixed type assertions in the monitoring router to eliminate unsafe any assignments. The monitoring page now has zero TypeScript errors and follows the project's type safety principles.

- [2025-07-04] **Fix** TypeScript Unsafe Enum Comparisons - Fixed all @typescript-eslint/no-unsafe-enum-comparison errors across the codebase, reducing from 65 to 0 errors. Replaced string literal comparisons with proper enum constant comparisons throughout the application. Key changes included: importing enums (UserRole, EventStatus, LogStatus, RunLocation, ConnectionType, WorkflowTriggerType, TokenStatus, EventType, UserStatus) from @/shared/schema where needed; replacing comparisons like `user.role === "ADMIN"` with `user.role === UserRole.ADMIN`; fixing monitoring page interface to type activity.status as LogStatus instead of string. Updated files in server tRPC routers, storage layer, scheduler, API routes, React hooks, and components. This ensures type-safe enum comparisons, prevents typos in string literals, and catches potential bugs at compile time rather than runtime.

- [2025-07-04] **Fix** TypeScript Template Expression Errors - Fixed all @typescript-eslint/restrict-template-expressions errors across the codebase, reducing from 271 to 0 errors. Fixed template literal expressions that used potentially null/undefined values by adding proper nullish coalescing (`${value ?? ""}`), String() conversion for numbers and ParamValue types (`${String(value)}`), and type guards where necessary. Key fixes included: dashboard admin page (email in toast notifications), event edit page (lang param from useParams), docs how-to page (20 lang parameters in href attributes), API routes (user emails and session emails in console.log statements), servers edit page (serverId parameters), workflows page (currentExecution.id), and admin terminal route (userId/serverId session keys). This ensures all template literals are type-safe and prevents runtime errors from undefined values in string interpolations.

- [2025-07-04] **Fix** TypeScript Nullish Coalescing - Fixed all @typescript-eslint/prefer-nullish-coalescing warnings across the codebase, reducing from 568 to 0 warnings. Replaced logical OR operators (||) with nullish coalescing operators (??) in appropriate contexts where null/undefined checks were intended. Fixed incorrect usage of ?? in logical conditions (middleware.ts, schema validation) by reverting to || operator. Updated expressions like `value || ""` to `value ?? ""` for proper null/undefined handling. Also fixed ternary expressions like `value === null ? undefined : value` to simpler `value ?? undefined`. This improves code correctness by distinguishing between falsy values (0, "", false) and nullish values (null, undefined).

- [2025-07-04] **Fix** TypeScript Unused Variables - Fixed all @typescript-eslint/no-unused-vars warnings across the codebase, reducing from 258 to 0 warnings. Removed unused imports including useCallback, toast, trpc, useRouter, and useParams from various components. Fixed unused function parameters in catch blocks by using parameterless catch syntax. Removed unused destructured variables like isSettingsLoading and loadingServers. Removed unused translation hooks (t, tCommon) from auth pages and components. Removed unused Lucide icons (Info, Edit) from imports. Removed unused interface definitions (User interface in admin page). This cleanup improves code maintainability and reduces bundle size by eliminating dead code.

- [2025-07-04] **Fix** Next.js Image Optimization - Fixed all @next/next/no-img-element warnings by replacing HTML `<img>` tags with Next.js optimized `<Image />` components. Updated 3 files: docs/getting-started/page.tsx (documentation step images), dashboard/layout.tsx (user profile avatar), and ui/logo.tsx (Cronium logo icon). This improves page load performance through automatic image optimization, lazy loading, and responsive image serving. All images now use proper width and height attributes for better Core Web Vitals scores.

- [2025-07-04] **Fix** TypeScript Consistent Type Imports - Fixed all @typescript-eslint/consistent-type-imports warnings across the codebase. Updated imports to use `import type` for type-only imports in 80+ files including API routes (NextRequest), React components (ReactNode, UseFormReturn), workflow components (Node, Edge from @xyflow/react), and schema types (UserRole, EventType, etc.). This improves build performance and makes type dependencies explicit. All NextRequest imports in API routes now use type imports, all React component prop types use type imports, and all schema enums used only for type annotations are properly imported as types.

- [2025-07-04] **Documentation** React Hook Form Implementation Phase 4 Complete - Successfully enhanced documentation and created migration resources. Updated RHF_GUIDE.md with comprehensive sections including: enhanced error handling patterns with root errors and async validation, expanded testing examples for Controller components and form reset, advanced TypeScript patterns with conditional validation and dynamic schemas, and complex form patterns for field arrays and multi-step forms. Created RHF_MIGRATION_CHECKLIST.md as a comprehensive template for developers migrating forms to React Hook Form, including pre-migration analysis, step-by-step migration guide, testing checklists, and common pitfalls to avoid. All 4 phases of the React Hook Form implementation plan are now complete.

- [2025-07-04] **Refactor** React Hook Form Implementation Phase 3 Complete - Successfully reviewed and improved all existing RHF implementations for best practices compliance. Reviewed settings page form which already follows all best practices. Refactored ai-settings.tsx, registration-settings.tsx, and smtp-settings.tsx to use Controller pattern for Switch and Select components instead of watch/setValue pattern, added proper accessibility with aria-describedby for error messages. Improved users-management.tsx by adding Controller for Select and accessibility attributes. Fixed ServerForm.tsx by removing unnecessary type assertions while maintaining proper FormField usage. All reviewed forms now follow RHF best practices including proper Controller usage, accessibility, and TypeScript type safety.

- [2025-07-04] **Refactor** React Hook Form Implementation Phase 2 Complete - Successfully refactored forms in Phase 2 of RHF implementation plan. Refactored ApiTokensManager.tsx to use React Hook Form with Zod validation for token creation (replaced useState with useForm, added validation schema). Refactored TemplateForm component in modular-tools-manager.tsx to use RHF with dynamic Zod schema based on tool type (email includes subject field). Refactored WorkflowDetailsForm.tsx to use RHF with comprehensive validation schema including all form fields (name, description, status, trigger type, schedule settings, tags, server overrides, and shared state). All refactored forms now follow best practices with proper TypeScript types, Form components using Controller pattern, and improved error handling. Forms identified but not refactored due to complexity: EventForm.tsx (very complex with many fields and dynamic behavior) and HttpRequestForm.tsx (uses prop drilling pattern, would require parent component refactoring).

- [2025-07-04] **Assessment** React Hook Form Implementation Phase 1 Complete - Reviewed all auth forms in Phase 1 of RHF implementation plan. Found that all three forms (forgot-password, reset-password, signin) are already properly implemented with React Hook Form following best practices: using useForm with Zod validation via zodResolver, proper TypeScript types, Form components with Controller pattern, server error handling with setError, and good accessibility. Phase 1 is already 100% complete. Ready to proceed with Phase 2.

- [2025-07-04] **Refactor** Complete Conditional Events to Conditional Actions rename (All 4 Phases) - Phase 1: Created database migration to rename `conditional_events` table to `conditional_actions` for better clarity and consistency. Updated schema.ts to use new table name `conditionalActions` and updated all related references including relations. Created migration files and rollback script for safe deployment. Phase 2: Updated all backend code including storage.ts (renamed methods like getSuccessEvents to getSuccessActions), event-handlers.ts (renamed handler functions), scheduler.ts (updated handler calls), API routes (updated field names from onSuccessEvents to onSuccessActions), and tRPC routers. Also renamed conditionalEventSchema to conditionalActionSchema and updated all type exports. Phase 3: Updated all frontend components including EventForm (state variables from conditionalEvents to conditionalActions), EventsList dashboard component, type definitions in types/index.ts, and validation schemas. All frontend references now consistently use "actions" terminology. Phase 4: Renamed documentation file from CONDITIONAL_EVENTS.md to CONDITIONAL_ACTIONS.md and updated all references within. Updated all code comments mentioning "conditional events" to "conditional actions". Updated schema-usage-analysis.md. This completes the comprehensive naming consistency improvement across the entire codebase.

- [2025-07-04] [Documentation] Created comprehensive database migration plan for migrating from Neon to self-hosted PostgreSQL, including detailed steps, code changes, rollback procedures, and migration scripts

- [2025-07-04] [Plan] Created comprehensive TypeScript error resolution plan with 7 phases and detailed checklists

## [Changes]

- [2025-07-04] [Fix] Completed Phase 1 of TypeScript error resolution:
  - Fixed WorkflowTriggerType.SCHEDULED vs SCHEDULE enum inconsistency (4 occurrences)
  - Fixed missing createEvent method - changed to createAction (2 occurrences)
  - Fixed duplicate ApiResponse type definitions by renaming first to BasicApiResponse
  - Fixed workflow execution history data structure access (8 errors)
  - Fixed tRPC router query parameter mismatches (3 occurrences)

- [2025-07-04] [Fix] Completed Phase 2 of TypeScript error resolution:
  - Fixed exactOptionalPropertyTypes compatibility issues (31 errors)
  - Updated Switch component to handle undefined checked prop
  - Fixed EventDetailsPopover to conditionally pass optional props
  - Fixed toast dismiss action to handle undefined toastId
  - Fixed Discord plugin validation to return proper error type
  - Updated script execution results to conditionally add optional properties
  - Fixed WorkflowDetailsForm to use TimeUnit enum for scheduleUnit

- [2025-07-04] [Fix] Completed Phase 3 of TypeScript error resolution:
  - Fixed auth.ts null/undefined JWT token assignments (5 errors)
  - Fixed SSH connection client assignments using delete instead of undefined
  - Fixed encryption service and useClientEncryption array access checks
  - Fixed seed script possibly undefined errors with null checks (18 errors)
  - Fixed template processor and clear-all-logs string parameter handling

- [2025-07-04] [Fix] Completed Phase 4 of TypeScript error resolution:
  - Fixed component prop type mismatches (12 component errors)
  - Fixed ResetCounterSwitch to use update mutation instead of resetCounter
  - Fixed WorkflowsCard date serialization from Date to string
  - Fixed events-table async handler by adding async wrapper
  - Fixed Terminal component return value for all code paths
  - Fixed IntegrationTestPanel webhook schema to include required message field
  - Fixed EventDetailsPopover conditional prop passing with exactOptionalPropertyTypes
  - Fixed WorkflowCanvas undefined node handling and prop name (onChange)
  - Fixed WorkflowForm to use correct WorkflowCanvas prop names
  - Reduced TypeScript errors from 102 to 27 (73% reduction)

- [2025-07-04] [Fix] Completed Phase 5 & 6 of TypeScript error resolution:
  - Phase 5: Fixed WorkflowExecutionHistory data structure issues (removed workflow property references, fixed refetchInterval)
  - Phase 6: Fixed tRPC client configuration by adding superjson transformer to httpBatchLink
  - Fixed AI service optional property access with optional chaining
  - Fixed useOptimisticUpdate hook with proper undefined checks
  - Fixed clear-all-logs script type conversions for SQL query results
  - Fixed variables router undefined access and exactOptionalPropertyTypes
  - Fixed seed-roles script to use isNull instead of eq with null
  - Fixed seed-workflows script with proper null checks for workflow and nodes
  - Fixed test setup error handling with proper type checking
  - Successfully resolved all TypeScript errors (0 remaining from initial 102)

## [Changes]
